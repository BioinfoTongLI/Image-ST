process {
	withName: CELLPOSE {
		containerOptions = {
			workflow.containerEngine == "singularity" ? "--containall --cleanenv --nv -B ${params.cellpose_model_dir}:/cellpose_models":
			( workflow.containerEngine == "docker" ? "--gpus all -v ${params.cellpose_model_dir}:/cellpose_models": null )
		}
		maxForks = 3
		// ext.args = "--flow_threshold 1.0 --cellprob_threshold -1.0"
	}

	withName: BIOINFOTONGLI_EXTRACTPEAKPROFILE {
		ext.args = "--y_col 'y_int' --x_col 'x_int'"
	}
	
	withName: Decode_peaks {
		ext.args = "--R 5"
	}

	withName: BIOINFOTONGLI_MICROALIGNER {
		storeDir = "output/registered_stacks/"
		cpus=30
	}

	withName: TO_SPATIALDATA {
		ext.args = "--y_col 'y_int' --x_col 'x_int' --feature_col 'Name'"
	}
}